rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{uid}/topics/{topicId} {
      allow read, write: if request.auth != null && request.auth.uid == uid
        && isValid(request.resource.data);
    }

    match /users/{uid}/favorites/{favId} {
      allow read, write: if request.auth != null && request.auth.uid == uid
        && isFavoriteValid(request.resource.data);
    }

    function isValid(data) {
      return (data.favorite is bool || !('favorite' in data))
        && (data.readLevel is int || !('readLevel' in data))
        && (!('readLevel' in data) || (data.readLevel >= 0 && data.readLevel <= 5));
    }

    function isFavoriteValid(data) {
      return (data.type is string || !('type' in data))
        && (data.itemId is string || !('itemId' in data))
        && (data.favorite is bool || !('favorite' in data));
    }
  }
}
